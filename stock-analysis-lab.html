<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InvestIQ - Stock Analysis Lab</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
    }
    
    /* Navigation */
    nav {
      background: rgba(255,255,255,0.95);
      padding: 15px 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .nav-links {
      display: flex;
      gap: 30px;
      list-style: none;
    }
    
    .nav-links a {
      text-decoration: none;
      color: #333;
      font-weight: 500;
      transition: color 0.3s;
    }
    
    .nav-links a:hover { color: #667eea; }
    .nav-links a.active { color: #667eea; border-bottom: 2px solid #667eea; }
    
    /* Container */
    .container {
      max-width: 1400px;
      margin: 30px auto;
      padding: 0 20px;
    }
    
    /* Header */
    .header-section {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-align: center;
    }
    
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 15px;
    }
    
    .subtitle {
      color: #666;
      font-size: 1.1rem;
    }
    
    /* Search Section */
    .search-card {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .search-box {
      display: flex;
      gap: 15px;
      max-width: 600px;
      margin: 0 auto;
    }
    
    input {
      flex: 1;
      padding: 15px 20px;
      font-size: 1.1rem;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      transition: border-color 0.3s;
    }
    
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      padding: 15px 40px;
      font-size: 1.1rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s;
    }
    
    button:hover { transform: scale(1.05); }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      background: white;
      padding: 15px;
      border-radius: 15px 15px 0 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      overflow-x: auto;
    }
    
    .tab {
      padding: 12px 25px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      color: #666;
      border-radius: 10px;
      white-space: nowrap;
      transition: all 0.3s;
    }
    
    .tab:hover { background: #f5f5f5; }
    .tab.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    
    /* Content Area */
    .content-area {
      background: white;
      padding: 40px;
      border-radius: 0 0 15px 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      min-height: 600px;
      display: none;
    }
    
    .content-area.active { display: block; }
    
    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 0.95rem;
    }
    
    th {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      position: sticky;
      top: 0;
    }
    
    td {
      padding: 12px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    tr:hover { background: #f9f9f9; }
    
    .historical { background: #f5f5f5; }
    .projected { background: #e3f2fd; }
    .calculated { color: #2e7d32; font-weight: 600; }
    .linked { color: #6a1b9a; }
    
    /* Metric Cards */
    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .metric-card {
      background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
      padding: 20px;
      border-radius: 15px;
      border-left: 4px solid #667eea;
    }
    
    .metric-label {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    
    .metric-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
    }
    
    /* Educational tooltips */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      color: #667eea;
      margin-left: 5px;
    }
    
    .tooltip:hover::after {
      content: attr(data-tip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      white-space: nowrap;
      font-size: 0.85rem;
      z-index: 1000;
    }
    
    /* Learning boxes */
    .learn-box {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
      border-left: 4px solid #ff9800;
      padding: 20px;
      margin: 20px 0;
      border-radius: 10px;
    }
    
    .learn-box h3 {
      color: #e65100;
      margin-bottom: 10px;
    }
    
    /* Error/Success messages */
    .message {
      padding: 15px 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    
    .error { background: #ffebee; color: #c62828; border-left: 4px solid #c62828; }
    .success { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #2e7d32; }
    .warning { background: #fff3e0; color: #e65100; border-left: 4px solid #e65100; }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .nav-links { display: none; }
      h1 { font-size: 2rem; }
      .tabs { flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav>
    <div class="logo">ğŸ“š InvestIQ</div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="flashcards.html">Flashcards</a></li>
      <li><a href="video-course.html">Video Courses</a></li>
      <li><a href="stock-analysis-lab.html" class="active">Stock Analysis Lab</a></li>
    </ul>
  </nav>

  <div class="container">
    <!-- Header -->
    <div class="header-section">
      <h1>ğŸ¦ Stock Analysis Lab</h1>
      <p class="subtitle">Institutional-Grade Financial Modeling â€¢ Learn by Doing</p>
    </div>

    <!-- Search -->
    <div class="search-card">
      <h2 style="text-align: center; margin-bottom: 20px;">Analyze Any Company</h2>
      <div class="search-box">
        <input 
          type="text" 
          id="symbolInput" 
          placeholder="Enter stock symbol (e.g., AAPL, BABA, MSFT...)"
          onkeypress="if(event.key==='Enter') analyzeStock()"
        >
        <button onclick="analyzeStock()">ğŸ” Analyze</button>
      </div>
      
      <div class="learn-box" style="margin-top: 30px;">
        <h3>ğŸ’¡ What You'll Learn</h3>
        <p>This lab teaches you how professional analysts at Morgan Stanley and Goldman Sachs build financial models. You'll learn:</p>
        <ul style="margin-left: 25px; margin-top: 10px;">
          <li>How to read and interpret financial statements</li>
          <li>How Income Statement, Balance Sheet, and Cash Flow connect</li>
          <li>How to value companies using DCF (Discounted Cash Flow)</li>
          <li>How working capital affects cash flow</li>
          <li>How to build assumptions and projections</li>
        </ul>
      </div>
    </div>

    <div id="messageBox"></div>

    <!-- Analysis Results -->
    <div id="analysisSection" style="display: none;">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('overview')">ğŸ“Š Overview</button>
        <button class="tab" onclick="switchTab('income')">ğŸ’° Income Statement</button>
        <button class="tab" onclick="switchTab('balance')">ğŸ¦ Balance Sheet</button>
        <button class="tab" onclick="switchTab('cashflow')">ğŸ’µ Cash Flow</button>
        <button class="tab" onclick="switchTab('integration')">ğŸ”— How They Connect</button>
        <button class="tab" onclick="switchTab('dcf')">ğŸ“ˆ DCF Valuation</button>
        <button class="tab" onclick="switchTab('assumptions')">âš™ï¸ Assumptions</button>
      </div>

      <!-- Tab Content Areas -->
      <div id="overview-content" class="content-area active">
        <div id="overviewData"></div>
      </div>

      <div id="income-content" class="content-area">
        <div id="incomeData"></div>
      </div>

      <div id="balance-content" class="content-area">
        <div id="balanceData"></div>
      </div>

      <div id="cashflow-content" class="content-area">
        <div id="cashflowData"></div>
      </div>

      <div id="integration-content" class="content-area">
        <div id="integrationData"></div>
      </div>

      <div id="dcf-content" class="content-area">
        <div id="dcfData"></div>
      </div>

      <div id="assumptions-content" class="content-area">
        <div id="assumptionsData"></div>
      </div>
    </div>
  </div>

  <script>
    let stockDatabase = null;
    let currentStock = null;
    
    // Load database
    window.addEventListener('DOMContentLoaded', async () => {
      console.log('Loading financial model database...');
      
      try {
        const response = await fetch('financial-model-data.json?' + Date.now());
        
        if (!response.ok) {
          showMessage('Database not found. Please run the data fetcher and upload financial-model-data.json', 'warning');
          return;
        }
        
        const data = await response.json();
        stockDatabase = data.stocks;
        
        console.log('âœ… Loaded', Object.keys(stockDatabase).length, 'companies');
        showMessage(`âœ… Database loaded: ${Object.keys(stockDatabase).length} companies available for analysis`, 'success');
        
        setTimeout(() => document.getElementById('messageBox').innerHTML = '', 3000);
        
      } catch (error) {
        console.error('Error:', error);
        showMessage('Failed to load database: ' + error.message, 'error');
      }
    });
    
    // Analyze stock
    async function analyzeStock() {
      const symbol = document.getElementById('symbolInput').value.trim().toUpperCase();
      
      if (!symbol) {
        showMessage('Please enter a stock symbol', 'error');
        return;
      }
      
      if (!stockDatabase) {
        showMessage('Database not loaded yet. Please wait...', 'warning');
        return;
      }
      
      if (!stockDatabase[symbol]) {
        const available = Object.keys(stockDatabase).slice(0, 10).join(', ');
        showMessage(`${symbol} not found. Try: ${available}...`, 'error');
        return;
      }
      
      currentStock = stockDatabase[symbol];
      displayAnalysis(currentStock);
      
      document.getElementById('analysisSection').style.display = 'block';
      document.getElementById('analysisSection').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Display analysis
    function displayAnalysis(stock) {
      displayOverview(stock);
      displayIncome(stock);
      displayBalance(stock);
      displayCashFlow(stock);
      displayIntegration(stock);
      displayDCF(stock);
      displayAssumptions(stock);
    }
    
    // Display Overview
    function displayOverview(stock) {
      const metrics = stock.currentMetrics;
      const latestIncome = stock.incomeStatements[0] || {};
      const latestBalance = stock.balanceSheets[0] || {};
      
      document.getElementById('overviewData').innerHTML = `
        <h2>${stock.symbol} - ${stock.name}</h2>
        <p style="color: #666; margin: 10px 0;">${stock.sector} â€¢ ${stock.industry}</p>
        
        <div class="learn-box">
          <h3>ğŸ“– What is a Stock Overview?</h3>
          <p>The overview gives you a quick snapshot of the company's size, profitability, and key metrics. Professional analysts start here to understand the business before diving into detailed models.</p>
        </div>
        
        <h3 style="margin-top: 30px;">Key Metrics</h3>
        <div class="metric-grid">
          <div class="metric-card">
            <div class="metric-label">Stock Price</div>
            <div class="metric-value">$${stock.price.toFixed(2)}</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Market Cap <span class="tooltip" data-tip="Total value of all shares">â„¹ï¸</span></div>
            <div class="metric-value">$${(stock.marketCap / 1e9).toFixed(1)}B</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">P/E Ratio <span class="tooltip" data-tip="Price divided by Earnings per Share">â„¹ï¸</span></div>
            <div class="metric-value">${metrics.pe || 'N/A'}</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Revenue (TTM)</div>
            <div class="metric-value">$${(latestIncome.revenue / 1e9).toFixed(1)}B</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Net Income</div>
            <div class="metric-value">$${(latestIncome.netIncome / 1e9).toFixed(1)}B</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Total Assets</div>
            <div class="metric-value">$${(latestBalance.totalAssets / 1e9).toFixed(1)}B</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">ROE <span class="tooltip" data-tip="Return on Equity - how efficiently company uses shareholder money">â„¹ï¸</span></div>
            <div class="metric-value">${metrics.roe}%</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Debt/Equity</div>
            <div class="metric-value">${metrics.debtToEquity || 'N/A'}</div>
          </div>
        </div>
        
        <div class="learn-box" style="margin-top: 30px;">
          <h3>ğŸ“ Related Learning</h3>
          <p>Want to learn more about these metrics?</p>
          <ul style="margin-left: 25px; margin-top: 10px;">
            <li><a href="video-course.html#valuation" style="color: #e65100; font-weight: 600;">ğŸ“¹ Video: Understanding P/E Ratios</a></li>
            <li><a href="flashcards.html#metrics" style="color: #e65100; font-weight: 600;">ğŸ´ Flashcards: Key Financial Metrics</a></li>
            <li><a href="video-course.html#roe" style="color: #e65100; font-weight: 600;">ğŸ“¹ Video: What is ROE?</a></li>
          </ul>
        </div>
      `;
    }
    
    // Display Income Statement
    function displayIncome(stock) {
      const statements = stock.incomeStatements.slice(0, 5);
      
      let tableHTML = `
        <h2>Income Statement (P&L)</h2>
        
        <div class="learn-box">
          <h3>ğŸ“– What is an Income Statement?</h3>
          <p>The Income Statement (also called Profit & Loss or P&L) shows how much money a company made and spent over a period. It follows this simple formula:</p>
          <p style="margin: 10px 0; font-weight: 600;">Revenue - Costs = Profit</p>
          <p>Professional analysts use this to understand profitability trends and operating efficiency.</p>
        </div>
        
        <table>
          <thead>
            <tr>
              <th>Item</th>
              ${statements.map(s => `<th>${s.date.substring(0, 4)}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Revenue</strong> <span class="tooltip" data-tip="Total sales - the starting point">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.revenue / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Cost of Revenue <span class="tooltip" data-tip="Direct costs to make/deliver products">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.costOfRevenue / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td><strong>Gross Profit</strong> <span class="tooltip" data-tip="Revenue - Cost of Revenue">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="calculated">$${(s.grossProfit / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td style="padding-left: 30px; color: #666;">Gross Margin %</td>
              ${statements.map(s => `<td>${((s.grossProfit / s.revenue) * 100).toFixed(1)}%</td>`).join('')}
            </tr>
            <tr>
              <td>Operating Expenses</td>
              ${statements.map(s => `<td class="historical">$${(s.operatingExpenses / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td><strong>EBIT</strong> <span class="tooltip" data-tip="Earnings Before Interest & Tax - operating profit">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="calculated">$${(s.ebit / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td style="padding-left: 30px; color: #666;">EBIT Margin %</td>
              ${statements.map(s => `<td>${((s.ebit / s.revenue) * 100).toFixed(1)}%</td>`).join('')}
            </tr>
            <tr>
              <td>Interest Expense</td>
              ${statements.map(s => `<td class="historical">$${(Math.abs(s.interestExpense) / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Pre-tax Income</td>
              ${statements.map(s => `<td class="calculated">$${(s.pretaxIncome / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Income Tax</td>
              ${statements.map(s => `<td class="historical">$${(s.incomeTax / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td><strong>Net Income</strong> <span class="tooltip" data-tip="Bottom line profit after all expenses">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="calculated" style="font-size: 1.1rem; background: #e8f5e9;">$${(s.netIncome / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td style="padding-left: 30px; color: #666;">Net Margin %</td>
              ${statements.map(s => `<td style="font-weight: 600;">${((s.netIncome / s.revenue) * 100).toFixed(1)}%</td>`).join('')}
            </tr>
          </tbody>
        </table>
        
        <div class="learn-box" style="margin-top: 30px;">
          <h3>ğŸ“ Key Takeaways</h3>
          <ul style="margin-left: 25px; margin-top: 10px;">
            <li><strong>Green numbers</strong> are calculated automatically from the formulas</li>
            <li><strong>Margins</strong> show profitability as % of revenue - higher is better</li>
            <li><strong>Net Income</strong> flows to Cash Flow Statement and Balance Sheet</li>
            <li>Watch for margin trends - improving margins mean better efficiency</li>
          </ul>
          <p style="margin-top: 15px;"><a href="video-course.html#income-statement" style="color: #e65100; font-weight: 600;">ğŸ“¹ Watch Video: How to Read an Income Statement</a></p>
        </div>
      `;
      
      document.getElementById('incomeData').innerHTML = tableHTML;
    }
    
    // Display Balance Sheet
    function displayBalance(stock) {
      const statements = stock.balanceSheets.slice(0, 5);
      
      let tableHTML = `
        <h2>Balance Sheet</h2>
        
        <div class="learn-box">
          <h3>ğŸ“– What is a Balance Sheet?</h3>
          <p>The Balance Sheet shows what a company owns (Assets) and owes (Liabilities) at a point in time. It must always balance:</p>
          <p style="margin: 10px 0; font-weight: 600;">Assets = Liabilities + Equity</p>
          <p>Think of it as a financial snapshot - what the company has and how it's financed.</p>
        </div>
        
        <table>
          <thead>
            <tr>
              <th>Item</th>
              ${statements.map(s => `<th>${s.date.substring(0, 4)}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="${statements.length + 1}" style="background: #667eea; color: white; font-weight: 700;">ASSETS</td></tr>
            <tr>
              <td>Cash & Equivalents</td>
              ${statements.map(s => `<td class="historical">$${(s.cashAndEquivalents / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Accounts Receivable <span class="tooltip" data-tip="Money customers owe us">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.accountsReceivable / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Inventory <span class="tooltip" data-tip="Products waiting to be sold">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.inventory / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Current Assets</td>
              ${statements.map(s => `<td class="calculated">$${(s.currentAssets / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>PP&E (Net) <span class="tooltip" data-tip="Property, Plant, Equipment - long-term assets">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.ppe / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td><strong>Total Assets</strong></td>
              ${statements.map(s => `<td class="calculated" style="font-weight: 700; background: #e3f2fd;">$${(s.totalAssets / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            
            <tr><td colspan="${statements.length + 1}" style="background: #667eea; color: white; font-weight: 700; padding-top: 20px;">LIABILITIES</td></tr>
            <tr>
              <td>Accounts Payable <span class="tooltip" data-tip="Money we owe suppliers">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.accountsPayable / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Current Debt</td>
              ${statements.map(s => `<td class="historical">$${(s.currentDebt / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Long-term Debt</td>
              ${statements.map(s => `<td class="historical">$${(s.longTermDebt / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td><strong>Total Liabilities</strong></td>
              ${statements.map(s => `<td class="calculated" style="font-weight: 700;">$${(s.totalLiabilities / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            
            <tr><td colspan="${statements.length + 1}" style="background: #667eea; color: white; font-weight: 700; padding-top: 20px;">EQUITY</td></tr>
            <tr>
              <td><strong>Total Equity</strong> <span class="tooltip" data-tip="Shareholders' stake in the company">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="calculated" style="font-weight: 700; background: #e8f5e9;">$${(s.totalEquity / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            
            <tr>
              <td><strong>CHECK: Assets = Liab + Equity</strong></td>
              ${statements.map(s => {
                const balanced = Math.abs(s.totalAssets - (s.totalLiabilities + s.totalEquity)) < 1e6;
                return `<td style="font-weight: 700; color: ${balanced ? '#2e7d32' : '#c62828'};">${balanced ? 'âœ“ PASS' : 'âœ— FAIL'}</td>`;
              }).join('')}
            </tr>
          </tbody>
        </table>
        
        <div class="learn-box" style="margin-top: 30px;">
          <h3>ğŸ“ Understanding the Balance Sheet</h3>
          <ul style="margin-left: 25px; margin-top: 10px;">
            <li><strong>Assets</strong> = What the company owns (cash, inventory, buildings)</li>
            <li><strong>Liabilities</strong> = What the company owes (debt, payables)</li>
            <li><strong>Equity</strong> = Shareholders' ownership = Assets - Liabilities</li>
            <li>The equation MUST always balance - that's why it's called a Balance Sheet!</li>
          </ul>
          <p style="margin-top: 15px;"><a href="video-course.html#balance-sheet" style="color: #e65100; font-weight: 600;">ğŸ“¹ Watch Video: Balance Sheet Basics</a></p>
        </div>
      `;
      
      document.getElementById('balanceData').innerHTML = tableHTML;
    }
    
    // Display Cash Flow
    function displayCashFlow(stock) {
      const statements = stock.cashFlows.slice(0, 5);
      
      let tableHTML = `
        <h2>Cash Flow Statement</h2>
        
        <div class="learn-box">
          <h3>ğŸ“– What is a Cash Flow Statement?</h3>
          <p>Shows actual cash moving in and out of the business. Remember: <strong>Profit â‰  Cash!</strong></p>
          <p>A company can be profitable but run out of cash. This statement shows the real cash position.</p>
        </div>
        
        <table>
          <thead>
            <tr>
              <th>Cash Flow Item</th>
              ${statements.map(s => `<th>${s.date.substring(0, 4)}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Operating Cash Flow</strong> <span class="tooltip" data-tip="Cash from business operations">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="historical">$${(s.operatingCashFlow / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Capital Expenditures (CapEx)</td>
              ${statements.map(s => `<td class="historical">($${(Math.abs(s.capex) / 1e9).toFixed(2)}B)</td>`).join('')}
            </tr>
            <tr>
              <td><strong>Free Cash Flow</strong> <span class="tooltip" data-tip="Cash available after maintaining business">â„¹ï¸</span></td>
              ${statements.map(s => `<td class="calculated" style="font-weight: 700; background: #e8f5e9;">$${(s.freeCashFlow / 1e9).toFixed(2)}B</td>`).join('')}
            </tr>
            <tr>
              <td>Dividends Paid</td>
              ${statements.map(s => `<td class="historical">($${(Math.abs(s.dividendsPaid) / 1e9).toFixed(2)}B)</td>`).join('')}
            </tr>
          </tbody>
        </table>
        
        <div class="learn-box" style="margin-top: 30px;">
          <h3>ğŸ“ Why Cash Flow Matters</h3>
          <ul style="margin-left: 25px; margin-top: 10px;">
            <li><strong>Free Cash Flow</strong> = Operating Cash Flow - CapEx</li>
            <li>This is the "true" cash the business generates</li>
            <li>Used for: dividends, debt repayment, acquisitions, buybacks</li>
            <li>Warren Buffett focuses on FCF more than earnings!</li>
          </ul>
          <p style="margin-top: 15px;"><a href="video-course.html#cash-flow" style="color: #e65100; font-weight: 600;">ğŸ“¹ Watch Video: Why FCF > Net Income</a></p>
        </div>
      `;
      
      document.getElementById('cashflowData').innerHTML = tableHTML;
    }
    
    // Display Integration
    function displayIntegration(stock) {
      document.getElementById('integrationData').innerHTML = `
        <h2>ğŸ”— How the Three Statements Connect</h2>
        
        <div class="learn-box">
          <h3>ğŸ“– The Golden Rule of Financial Modeling</h3>
          <p>The three statements are NOT independent - they're interconnected. Understanding these links is what separates beginners from professional analysts.</p>
        </div>
        
        <div style="background: #f5f5f5; padding: 30px; border-radius: 15px; margin: 30px 0;">
          <pre style="font-size: 0.9rem; line-height: 1.8; color: #333;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INCOME STATEMENT                             â”‚
â”‚                                                                   â”‚
â”‚  Revenue                                                          â”‚
â”‚  - Cost of Revenue                                                â”‚
â”‚  = Gross Profit                                                   â”‚
â”‚  - Operating Expenses                                             â”‚
â”‚  = EBIT                                                           â”‚
â”‚  - Interest Expense  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  = Pre-tax Income                       â”‚                         â”‚
â”‚  Ã— (1 - Tax Rate)                       â”‚                         â”‚
â”‚  = NET INCOME  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚               â”‚
                          â†“               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CASH FLOW STATEMENT                             â”‚
â”‚                                                                   â”‚
â”‚  Net Income  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                         â”‚
â”‚  + Depreciation                         â”‚                         â”‚
â”‚  - Î” Working Capital                    â”‚                         â”‚
â”‚  = Operating Cash Flow                  â”‚                         â”‚
â”‚  - CapEx                                â”‚                         â”‚
â”‚  = FREE CASH FLOW                       â”‚                         â”‚
â”‚                                         â”‚                         â”‚
â”‚  Financing:                             â”‚                         â”‚
â”‚    + Debt Issuance                      â”‚                         â”‚
â”‚    - Debt Repayment                     â”‚                         â”‚
â”‚    - Dividends                          â”‚                         â”‚
â”‚  = Net Change in Cash  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚         â”‚
                                          â”‚         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BALANCE SHEET                                â”‚
â”‚                                                                   â”‚
â”‚  ASSETS:                                                          â”‚
â”‚    Cash  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚    Accounts Receivable                                            â”‚
â”‚    Inventory                                                      â”‚
â”‚    PP&E                                                           â”‚
â”‚                                                                   â”‚
â”‚  LIABILITIES:                                                     â”‚
â”‚    Accounts Payable                                               â”‚
â”‚    Debt  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                   â”‚
â”‚  EQUITY:                                                          â”‚
â”‚    Prior Equity + Net Income - Dividends                          â”‚
â”‚                                                                   â”‚
â”‚  CHECK: Assets = Liabilities + Equity                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          </pre>
        </div>
        
        <div class="learn-box">
          <h3>ğŸ“ Key Linkages to Remember</h3>
          <ol style="margin-left: 25px; margin-top: 10px; line-height: 1.8;">
            <li><strong>Net Income</strong> from Income Statement â†’ Cash Flow Statement starting point</li>
            <li><strong>Net Income</strong> â†’ Increases Equity on Balance Sheet</li>
            <li><strong>Depreciation</strong> â†’ Added back in Cash Flow (non-cash expense)</li>
            <li><strong>CapEx</strong> â†’ Increases PP&E on Balance Sheet</li>
            <li><strong>Net Change in Cash</strong> â†’ Updates Cash on Balance Sheet</li>
            <li><strong>Debt Issuance/Repayment</strong> â†’ Changes Debt on Balance Sheet</li>
            <li><strong>Interest Expense</strong> on Income Statement â† Based on Debt balance</li>
          </ol>
        </div>
        
        <div class="learn-box" style="margin-top: 20px;">
          <h3>ğŸ’¡ Why This Matters</h3>
          <p>In professional modeling at banks:</p>
          <ul style="margin-left: 25px; margin-top: 10px;">
            <li>Change ONE assumption (e.g., revenue growth) â†’ All three statements update automatically</li>
            <li>The model must balance â†’ Assets always = Liabilities + Equity</li>
            <li>Cash is the connecting thread between all three statements</li>
            <li>This is how analysts build 5-10 year projections</li>
          </ul>
          <p style="margin-top: 15px;"><a href="video-course.html#3-statement" style="color: #e65100; font-weight: 600;">ğŸ“¹ Watch Video: Building an Integrated 3-Statement Model</a></p>
        </div>
      `;
    }
    
    // Display DCF
    function displayDCF(stock) {
      // Simple DCF calculation
      const fcfs = stock.cashFlows.slice(0, 5).map(cf => cf.freeCashFlow);
      const avgFCF = fcfs.reduce((a, b) => a + b, 0) / fcfs.length;
      
      const growthRate = 0.05; // 5% assumption
      const wacc = 0.095; // 9.5%
      const terminalGrowth = 0.03; // 3%
      
      let projectedFCF = [];
      let pv = [];
      
      for (let i = 1; i <= 5; i++) {
        const fcf = avgFCF * Math.pow(1 + growthRate, i);
        const discount = Math.pow(1 + wacc, i);
        projectedFCF.push(fcf);
        pv.push(fcf / discount);
      }
      
      const terminalValue = (projectedFCF[4] * (1 + terminalGrowth)) / (wacc - terminalGrowth);
      const pvTerminal = terminalValue / Math.pow(1 + wacc, 5);
      
      const enterpriseValue = pv.reduce((a, b) => a + b, 0) + pvTerminal;
      const latestBalance = stock.balanceSheets[0] || {};
      const equityValue = enterpriseValue + latestBalance.cashAndEquivalents - latestBalance.longTermDebt;
      const fairValue = equityValue / stock.sharesOutstanding;
      const upside = ((fairValue - stock.price) / stock.price) * 100;
      
      document.getElementById('dcfData').innerHTML = `
        <h2>ğŸ“ˆ DCF Valuation Model</h2>
        
        <div class="learn-box">
          <h3>ğŸ“– What is DCF?</h3>
          <p><strong>Discounted Cash Flow</strong> is THE gold standard for valuation. It answers: "What is this company worth based on future cash flows?"</p>
          <p style="margin-top: 10px;">The formula: <strong>Value = Sum of all future cash flows, discounted to today</strong></p>
        </div>
        
        <h3 style="margin-top: 30px;">Free Cash Flow Projections</h3>
        <table>
          <thead>
            <tr>
              <th>Year</th>
              <th>FCF</th>
              <th>Discount Factor</th>
              <th>Present Value</th>
            </tr>
          </thead>
          <tbody>
            ${projectedFCF.map((fcf, i) => `
              <tr>
                <td>Year ${i + 1}</td>
                <td class="projected">$${(fcf / 1e9).toFixed(2)}B</td>
                <td>${(1 / Math.pow(1 + wacc, i + 1)).toFixed(3)}</td>
                <td class="calculated">$${(pv[i] / 1e9).toFixed(2)}B</td>
              </tr>
            `).join('')}
            <tr style="border-top: 2px solid #667eea;">
              <td colspan="3"><strong>Terminal Value (Year 6+)</strong></td>
              <td class="calculated" style="font-weight: 700;">$${(pvTerminal / 1e9).toFixed(2)}B</td>
            </tr>
          </tbody>
        </table>
        
        <div class="metric-grid" style="margin-top: 30px;">
          <div class="metric-card">
            <div class="metric-label">Enterprise Value</div>
            <div class="metric-value">$${(enterpriseValue / 1e9).toFixed(1)}B</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Equity Value</div>
            <div class="metric-value">$${(equityValue / 1e9).toFixed(1)}B</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Fair Value / Share</div>
            <div class="metric-value">$${fairValue.toFixed(2)}</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Current Price</div>
            <div class="metric-value">$${stock.price.toFixed(2)}</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-label">Upside / (Downside)</div>
            <div class="metric-value" style="color: ${upside > 0 ? '#2e7d32' : '#c62828'};">${upside > 0 ? '+' : ''}${upside.toFixed(1)}%</div>
          </div>
        </div>
        
        <div class="learn-box" style="margin-top: 30px;">
          <h3>ğŸ“ DCF Assumptions Used</h3>
          <ul style="margin-left: 25px; margin-top: 10px;">
            <li><strong>FCF Growth Rate:</strong> ${(growthRate * 100).toFixed(1)}% (how fast cash flow grows)</li>
            <li><strong>WACC:</strong> ${(wacc * 100).toFixed(1)}% (Weighted Average Cost of Capital - discount rate)</li>
            <li><strong>Terminal Growth:</strong> ${(terminalGrowth * 100).toFixed(1)}% (long-term growth forever)</li>
          </ul>
          <p style="margin-top: 15px;">âš ï¸ <strong>Remember:</strong> DCF is sensitive to assumptions. Small changes in growth rate or WACC can dramatically change the valuation!</p>
          <p style="margin-top: 15px;"><a href="video-course.html#dcf" style="color: #e65100; font-weight: 600;">ğŸ“¹ Watch Video: Mastering DCF Valuation</a></p>
        </div>
      `;
    }
    
    // Display Assumptions
    function displayAssumptions(stock) {
      document.getElementById('assumptionsData').innerHTML = `
        <h2>âš™ï¸ Key Modeling Assumptions</h2>
        
        <div class="learn-box">
          <h3>ğŸ“– Why Assumptions Matter</h3>
          <p>In financial modeling, <strong>assumptions drive everything</strong>. Professional analysts spend most of their time getting assumptions right, not building formulas.</p>
          <p style="margin-top: 10px;">The quality of your model = The quality of your assumptions</p>
        </div>
        
        <h3 style="margin-top: 30px;">Growth Assumptions</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0;">
          <p style="margin: 5px 0;"><strong>Revenue Growth Rate:</strong> 5.0% - 7.0%</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">Based on: Historical growth, industry trends, competitive position</p>
          
          <p style="margin: 15px 0 5px 0;"><strong>Terminal Growth Rate:</strong> 3.0%</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">Usually set at GDP growth rate (2-3%) - companies can't grow faster than economy forever</p>
        </div>
        
        <h3 style="margin-top: 30px;">Margin Assumptions</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0;">
          <p style="margin: 5px 0;"><strong>Gross Margin:</strong> Historical trend + operational efficiency gains</p>
          <p style="margin: 5px 0;"><strong>Operating Expenses:</strong> As % of revenue, declining with scale</p>
          <p style="margin: 5px 0;"><strong>Tax Rate:</strong> 21% (U.S. corporate tax rate)</p>
        </div>
        
        <h3 style="margin-top: 30px;">Working Capital Assumptions</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0;">
          <p style="margin: 5px 0;"><strong>Days Sales Outstanding (DSO):</strong> 40 days</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">How long to collect from customers</p>
          
          <p style="margin: 15px 0 5px 0;"><strong>Days Inventory Outstanding (DIO):</strong> 52 days</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">How long inventory sits before being sold</p>
          
          <p style="margin: 15px 0 5px 0;"><strong>Days Payable Outstanding (DPO):</strong> 57 days</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">How long before we pay suppliers</p>
        </div>
        
        <h3 style="margin-top: 30px;">CapEx & Depreciation</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0;">
          <p style="margin: 5px 0;"><strong>CapEx as % of Revenue:</strong> 6.5%</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">Maintenance + Growth CapEx</p>
          
          <p style="margin: 15px 0 5px 0;"><strong>Depreciation Rate:</strong> 8.0% of PP&E</p>
        </div>
        
        <h3 style="margin-top: 30px;">DCF Assumptions</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0;">
          <p style="margin: 5px 0;"><strong>WACC:</strong> 9.5%</p>
          <p style="color: #666; font-size: 0.9rem; margin-left: 20px;">Weighted Average Cost of Capital = Cost of Equity Ã— (E/V) + Cost of Debt Ã— (D/V) Ã— (1-Tax)</p>
        </div>
        
        <div class="learn-box" style="margin-top: 30px;">
          <h3>ğŸ“ How Analysts Build Assumptions</h3>
          <ol style="margin-left: 25px; margin-top: 10px; line-height: 1.8;">
            <li><strong>Historical Analysis:</strong> Look at 5-10 year trends</li>
            <li><strong>Management Guidance:</strong> What does the company say?</li>
            <li><strong>Industry Benchmarks:</strong> Compare to competitors</li>
            <li><strong>Macroeconomic Factors:</strong> GDP growth, interest rates, etc.</li>
            <li><strong>Sensitivity Analysis:</strong> Test what happens if you're wrong!</li>
          </ol>
          <p style="margin-top: 15px;"><a href="video-course.html#assumptions" style="color: #e65100; font-weight: 600;">ğŸ“¹ Watch Video: Building Bulletproof Assumptions</a></p>
        </div>
        
        <div class="learn-box" style="margin-top: 20px; background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-left-color: #1976d2;">
          <h3 style="color: #0d47a1;">ğŸ’¼ Practice Exercise</h3>
          <p><strong>Your Turn:</strong> Try creating assumptions for a different company!</p>
          <ol style="margin-left: 25px; margin-top: 10px;">
            <li>Pick a company you know (AAPL, MSFT, GOOGL)</li>
            <li>Research their historical growth rates</li>
            <li>Compare margins to competitors</li>
            <li>Build your own assumption set</li>
            <li>See how it changes the valuation!</li>
          </ol>
          <p style="margin-top: 15px;"><a href="flashcards.html#assumptions" style="color: #0d47a1; font-weight: 600;">ğŸ´ Test Yourself: Assumptions Flashcards</a></p>
        </div>
      `;
    }
    
    // Switch tabs
    function switchTab(tabName) {
      // Hide all content
      document.querySelectorAll('.content-area').forEach(area => {
        area.classList.remove('active');
      });
      
      // Remove active from all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected content
      document.getElementById(tabName + '-content').classList.add('active');
      
      // Mark tab as active
      event.target.classList.add('active');
    }
    
    // Show message
    function showMessage(msg, type) {
      document.getElementById('messageBox').innerHTML = `<div class="message ${type}">${msg}</div>`;
    }
  </script>
</body>
</html>
